<ion-header>
  <ion-toolbar color="success">
    <ion-buttons slot="start">
      <ion-button routerLink="/farmer-dashboard">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Thêm sản phẩm</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="add-product-content">
  <form (ngSubmit)="onSubmit()" class="product-form">
    <!-- Image Upload -->
    <div class="image-upload">
      <div class="image-preview" *ngIf="imagePreview">
        <img [src]="imagePreview" alt="Preview" />
      </div>
      <div class="upload-placeholder" *ngIf="!imagePreview">
        <ion-icon name="cloud-upload"></ion-icon>
        <p>Chọn ảnh sản phẩm</p>
      </div>
      <input type="file" accept="image/*" (change)="onImageSelected($event)" #fileInput hidden />
      <ion-button expand="block" fill="outline" (click)="fileInput.click()">
        Chọn ảnh
      </ion-button>
    </div>

    <!-- Form Fields -->
    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Tên sản phẩm *</ion-label>
      <ion-input 
        type="text" 
        [(ngModel)]="productData.name"
        name="name"
        placeholder="VD: Cà chua cherry"
        required>
      </ion-input>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Mô tả</ion-label>
      <ion-textarea 
        [(ngModel)]="productData.description"
        name="description"
        placeholder="Mô tả chi tiết về sản phẩm"
        rows="4">
      </ion-textarea>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Danh mục *</ion-label>
      <ion-select 
        [(ngModel)]="productData.category_id"
        name="category"
        placeholder="Chọn danh mục"
        interface="popover"
        required>
        <ion-select-option *ngFor="let cat of categories" [value]="cat.id">
          {{ cat.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Giá (VNĐ) *</ion-label>
      <ion-input 
        type="number" 
        [(ngModel)]="productData.price"
        name="price"
        placeholder="50000"
        required>
      </ion-input>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Số lượng</ion-label>
      <ion-input 
        type="number" 
        [(ngModel)]="productData.quantity"
        name="quantity"
        placeholder="100">
      </ion-input>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Đơn vị</ion-label>
      <ion-input 
        type="text" 
        [(ngModel)]="productData.unit"
        name="unit"
        placeholder="VD: kg, thùng, bó">
      </ion-input>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Nguồn gốc</ion-label>
      <ion-input 
        type="text" 
        [(ngModel)]="productData.origin"
        name="origin"
        value="Đà Lạt">
      </ion-input>
    </ion-item>

    <ion-item lines="none" class="input-item">
      <ion-label position="stacked">Ngày thu hoạch</ion-label>
      <ion-input 
        type="date" 
        [(ngModel)]="productData.harvest_date"
        name="harvest_date">
      </ion-input>
    </ion-item>

    <ion-button 
      expand="block" 
      type="submit" 
      class="submit-btn"
      [disabled]="loading">
      <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
      <ion-icon *ngIf="!loading" name="save" slot="start"></ion-icon>
      <span *ngIf="!loading">Lưu sản phẩm</span>
    </ion-button>
  </form>
</ion-content>
